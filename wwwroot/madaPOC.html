<!DOCTYPE html>
<html>
<head>
    <title>Mada POC</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body>

    <h1 style="text-align: center;">MADA Integration POC</h1>
    <hr />
    <br />
    <input type="button" id="btnPay" value="Pay" style="margin-left: 200px; height: 50px; width:150px" />

    <script src="https://test-gateway.mastercard.com/checkout/version/57/checkout.js"
            data-error="errorCallback"
            data-cancel="cancelCallback">
    </script>

    <script type="text/javascript">
        sessionId = '';
        sessionURL = "https://test-gateway.mastercard.com/api/rest/version/57/merchant/5432154321/session";
        retunURL = "http://madapoc.com/";
        APIUserName = 'merchant.5432154321';
        APIPassword = 'fe7cb3b543f83442957a4cea7a385d02';

        order = {
            amount: function () { return 80 + 20; },
            currency: 'SAR',
            description: 'Ordered goods',
            id: getdate(),
            reference: "1236"
        };

        function errorCallback(error) {
          
            console.log(JSON.stringify(error));
        }
        function cancelCallback() {
          
            console.log('Payment cancelled');
        }

        Checkout.configure({
            merchant: '5432154321',
            order: {
                description: 'Mastercard basketball sneakers size 10',
            },
            session: {
                id: "SESSION0002354519108G28031160E9"
            },           
            interaction: {
                merchant: {
                    name: 'SFDA',
                    address: {
                        line1: '200 Sample St',
                        line2: '1234 Example Town'
                    }
                },                                
            }
        });

        function getdate() {
            var today = new Date();
            var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            return dateTime = date + ' ' + time;
        }

        function paymentInit() {
            $.ajax({
                type: "POST",
                url: sessionURL,
                Accept: 'application/json',
                dataType: 'json',
                headers: {
                    "Authorization": "Basic " + btoa(APIUserName + ":" + APIPassword)
                },
                data: JSON.stringify(
                    {
                        "apiOperation": "CREATE_CHECKOUT_SESSION",
                        "interaction": { "operation": "PURCHASE", "returnUrl": retunURL },
                        "order": order,
                        "transaction": { "reference": "123456" }
                    }
                ),
                success: function (e) {
                    sessionId = e.session.id;
                }
            });
        }
    </script>

    <script>      
        configureCheckout = function (sessionId) {           
            //Checkout.configure({
            //    merchant: '5432154321',
            //    order: {
            //        description: 'Mastercard basketball sneakers size 10',
            //    },
            //    session: {
            //        id: sessionId
            //    },
            //    interaction: {
            //        merchant: {
            //            name: 'Merchant',
            //            email: "support@merchant.com",
            //            phone: "+966118352514",

            //            address: {
            //                line1: 'Dubai',
            //                line2: 'UAE'
            //            }
            //        },
            //        displayControl: {
            //            billingAddress: "MANDATORY",
            //            customerEmail: "OPTIONAL",
            //            orderSummary: "SHOW",
            //            paymentConfirmation: "HIDE",
            //            paymentTerms: "HIDE",
            //        },
            //    },
            //});

            //Checkout.configure({
            //    session: { id: sessionId },
            //    interaction: {
            //        merchant: {
            //            name: '5432154321',
            //            address: {
            //                line1: '200 Sample St',
            //                line2: '1234 Example Town'
            //            },
            //            order: {
            //                amount: 500,//OrderAmount(250),
            //                currency: 'SAR',
            //                description: 'Ordered goods',
            //                id: 'TEST_ORDER_ID',
            //                reference: 'TEST_ORDER_REF'
            //            }
            //        }
            //    }
            //});
        }

        $(document).ready(function () {

            $('#btnPay').click(function () {

                paymentInit();

                Checkout.showLightbox();
            });
        });

    </script>

</body>
</html>